# &#x20;项目介绍

本项目是针对使用RetinaFace-FaceNet进行人脸检测识别签到的项目

能够实时进行人脸检测与识别功能，

并将签到时间记录在表格上(未实现）

# &#x20;环境依赖

目前已测试过Python3.10 ,torch 1.13.1 , torchvision0.14.1

```bash
conda create -n py310 python=3.10
conda activate py310
pip install -r requirements.txt
```





## 预测步骤

1.  本项目自带主干为mobilenet的retinaface模型与facenet模型。可以直接运行，如果想要使用主干为resnet50的retinafa和主干为inception*resnetv1的facenet模型需要在*face\_detected/retinaface.py文件里面，在如下部分修改model\_path和backbone使其对应训练好的文件。



    _defaults = {
            #----------------------------------------------------------------------#
            #   retinaface训练完的权值路径  model_data/Retinaface_resnet50.pth 与 resnet50 配用  model_data/Retinaface_mobilenet0.25.pth 与 mobilenet 配用
            #----------------------------------------------------------------------#
            "retinaface_model_path" : ROOT / 'model_data/Retinaface_mobilenet0.25.pth',
            #----------------------------------------------------------------------#
            #   retinaface所使用的主干网络，有mobilenet和resnet50
            #----------------------------------------------------------------------#
            "retinaface_backbone"   : "mobilenet",
            #----------------------------------------------------------------------#
            #   retinaface中只有得分大于置信度的预测框会被保留下来
            #----------------------------------------------------------------------#
            "confidence"            : 0.5,
            #----------------------------------------------------------------------#
            #   retinaface中非极大抑制所用到的nms_iou大小
            #----------------------------------------------------------------------#
            "nms_iou"               : 0.3,
            #----------------------------------------------------------------------#
            #   是否需要进行图像大小限制。
            #   输入图像大小会大幅度地影响FPS，想加快检测速度可以减少input_shape。
            #   开启后，会将输入图像的大小限制为input_shape。否则使用原图进行预测。
            #   会导致检测结果偏差，主干为resnet50不存在此问题。
            #   可根据输入图像的大小自行调整input_shape，注意为32的倍数，如[640, 640, 3]
            #----------------------------------------------------------------------#
            "retinaface_input_shape": [640, 640, 3],
            #----------------------------------------------------------------------#
            #   是否需要进行图像大小限制。
            #----------------------------------------------------------------------#
            "letterbox_image"       : True,
            
            #----------------------------------------------------------------------#
            #   facenet训练完的权值路径 ../model_data/facenet_mobilenet.pth  ROOT / 'model_data/facenet_inception_resnetv1.pth'
            #----------------------------------------------------------------------#
            "facenet_model_path"    :  ROOT / 'model_data/facenet_mobilenet.pth',
            #----------------------------------------------------------------------#
            #   facenet所使用的主干网络， mobilenet和inception_resnetv1
            #----------------------------------------------------------------------#
            "facenet_backbone"      : "mobilenet",
            #----------------------------------------------------------------------#
            #   facenet所使用到的输入图片大小
            #----------------------------------------------------------------------#
            "facenet_input_shape"   : [160, 160, 3],
            #----------------------------------------------------------------------#
            #   facenet所使用的人脸距离门限
            #----------------------------------------------------------------------#
            "facenet_threhold"      : 0.9,

            #--------------------------------#
            #   是否使用Cuda
            #   没有GPU可以设置成False
            #--------------------------------#
            "cuda"                  : False
        }

1.  运行encoding.py，对face\_dataset里面的图片进行编码，face\_dataset的命名规则为XXX\_1.jpg、XXX\_2.jpg。最终在model\_data文件夹下生成对应的数据库人脸编码数据文件(npy)。
2.  **run**

    python main.py -m predict



    face_db/test_datasets/obama.jpg

1.  在predict.py里面进行设置可以进行fps测试和video视频检测。

有啥问题继续补充技术文档

